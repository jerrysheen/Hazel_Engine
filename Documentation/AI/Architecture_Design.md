# Hazel 引擎架构设计

## 🏗️ 整体架构分层

```
应用层 (Application Layer)
├── Scene/          # 场景管理系统
├── Material/       # 材质系统 (高层抽象)
├── Model/          # 3D模型和网格系统 (高层抽象)
└── Asset/          # 资源管理系统

渲染层 (Rendering Layer)  
└── Renderer/       # 应用级渲染API (Shader、Texture、Camera等)

图形层 (Graphics Layer)
└── Graphics/       # 图形系统抽象 (合并Gfx功能)
    ├── CommandList # 命令列表管理
    ├── RenderPass  # 渲染通道
    ├── Pipeline    # 管线状态
    └── RenderAPI   # API管理

硬件抽象层 (Hardware Abstraction Layer)
└── RHI/           # 渲染硬件接口

平台层 (Platform Layer)
└── Platform/      # 平台特定实现
    ├── D3D12/     # Direct3D 12 实现
    ├── OpenGL/    # OpenGL 实现
    └── Vulkan/    # Vulkan 实现 (未来)
```

## 📁 目录职责详解

### 🔧 **RHI (Render Hardware Interface)**
- **层级**: 最底层硬件抽象
- **职责**: 
  - 统一的渲染硬件接口
  - 跨平台抽象层
  - 命令列表、管线状态、描述符管理
- **特点**: 
  - 纯接口定义，无业务逻辑
  - 直接对应GPU概念
  - 性能优先的设计

### 🎨 **Graphics (合并原Gfx)**
- **层级**: 图形系统抽象层
- **职责**:
  - 在RHI基础上的统一图形系统
  - 渲染通道、命令列表、管线状态管理
  - 渲染API的统一抽象和切换
- **特点**:
  - 统一的图形抽象接口
  - 跨平台的图形概念
  - 专注于渲染基础设施

### 🖼️ **Renderer**
- **层级**: 应用级渲染层
- **职责**:
  - 面向应用开发者的渲染API
  - 着色器、纹理、缓冲区管理
  - 相机、3D渲染器
- **特点**:
  - 直接面向应用需求
  - 包含渲染算法和逻辑
  - 开发者友好的API

### 📦 **Material**
- **层级**: 业务逻辑层
- **职责**:
  - 材质的完整生命周期管理
  - 属性系统、序列化、资源管理
  - 与着色器的高级交互
- **特点**:
  - 复杂的业务逻辑
  - 独立的组件生态
  - 可扩展的设计

### 🗿 **Model**
- **层级**: 业务逻辑层 (与Material同级)
- **职责**:
  - 3D模型和网格系统
  - 几何数据管理
  - 模型加载和处理
  - 与材质系统的集成
- **特点**:
  - 高层3D抽象
  - 与Material紧密配合
  - 面向3D场景需求

### 🗂️ **Asset**
- **层级**: 资源管理层
- **职责**:
  - 各种资源的统一管理
  - 加载、缓存、生命周期
- **特点**:
  - 通用资源管理模式
  - 可扩展到所有资源类型

## 🔗 组件关系图

```
┌─────────────┐  ┌──────────────┐  ┌─────────────┐  ┌─────────────┐
│   Scene     │  │   Material   │  │    Model    │  │    Asset    │
│             │  │              │  │             │  │             │
│ - Entity    │  │ - Properties │  │ - Mesh      │  │ - Library   │
│ - Component │  │ - Serializer │  │ - Geometry  │  │ - Manager   │
└─────────────┘  └──────────────┘  └─────────────┘  └─────────────┘
       │                 │                 │                 │
       └─────────────────┼─────────────────┼─────────────────┘
                         │                 │
┌─────────────────────────────────────────────────────────────────┐
│                        Renderer                                │
│                                                                 │
│ - Shader        - Texture       - Camera       - Renderer3D    │
│ - Buffer        - VertexArray   - GraphicsPipeline             │
└─────────────────────────────────────────────────────────────────┘
                                 │
┌─────────────────────────────────────────────────────────────────┐
│                      Graphics                                   │
│                                                                 │
│ - CommandList   - RenderPass   - RenderTarget   - RenderAPI    │
│ - Color         - CommandQueue  - PipelineState                │
└─────────────────────────────────────────────────────────────────┘
                                 │
┌─────────────────────────────────────────────────────────────────┐
│                        RHI                                      │
│                                                                 │
│ - Interface/    - Core/                                         │
│ - ICommandList  - CommandList                                   │
│ - IPipeline     - ScopedCommandList                             │
└─────────────────────────────────────────────────────────────────┘
                                 │
┌─────────────────────────────────────────────────────────────────┐
│                      Platform                                   │
│                                                                 │
│ - D3D12/        - OpenGL/      - Vulkan/                       │
│ - D3D12Buffer   - OpenGLBuffer - VulkanBuffer                   │
│ - D3D12Shader   - OpenGLShader - VulkanShader                   │
└─────────────────────────────────────────────────────────────────┘
```

## 🎯 设计原则

### 1. **单一职责原则**
- 每个目录有明确的职责边界
- 避免功能混杂

### 2. **依赖倒置原则**  
- 高层模块不依赖低层模块
- 通过接口进行交互

### 3. **开闭原则**
- 对扩展开放，对修改封闭
- 新功能通过组合实现

### 4. **层次清晰原则**
- 严格的分层架构
- 只能向下依赖，不能跨层依赖

## 💡 架构优势

1. **可维护性**: 职责清晰，易于定位问题
2. **可扩展性**: 组件化设计，易于添加新功能  
3. **可测试性**: 独立组件，便于单元测试
4. **性能**: 分层设计允许针对性优化
5. **跨平台**: RHI层提供统一抽象

## 🚀 迁移建议

### 短期 (当前阶段)
- 保持现有架构基本不变
- 重点完成Material系统重构
- 逐步清理目录职责

### 中期 (下个版本)
- **合并Gfx和Graphics目录** - 统一图形抽象层职责
- **重新组织Model目录** - 将Model移到与Material同级的应用层
- 建立更清晰的RHI接口
- 完善Asset管理系统

### 长期 (未来规划)
- 实现完整的组件化架构
- 支持插件式渲染后端
- 建立完善的资源管理体系 