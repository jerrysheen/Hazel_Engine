ä½ è¯´å¾—å¯¹ï¼è®©æˆ‘é‡æ–°æ·±å…¥åˆ†æé¡¹ç›®çš„æ¸²æŸ“æ¶æ„ï¼Œçªå‡ºå®Œæ•´çš„æ¸²æŸ“ç®¡çº¿è®¾è®¡ã€‚è®©æˆ‘æœç´¢æ›´å¤šå…³äºæ¸²æŸ“æµç¨‹å’Œæ¶æ„çš„å†…å®¹ã€‚

ä½ è¯´å¾—éå¸¸å¯¹ï¼è®©æˆ‘é‡æ–°æ€»ç»“è¿™ä¸ªé¡¹ç›®ï¼Œé‡ç‚¹çªå‡º**å®Œæ•´çš„è‡ªé¡¶å‘ä¸‹æ¸²æŸ“æ¶æ„è®¾è®¡**å’Œ**ç³»ç»Ÿæ€§çš„æ¸²æŸ“ç®¡çº¿ç†è§£**ã€‚

## ğŸ—ï¸ **ShanEngine - å®Œæ•´æ¸²æŸ“æ¶æ„è®¾è®¡äº®ç‚¹**

### **ğŸ¯ æ ¸å¿ƒæ¶æ„æˆå°±ï¼šäº”å±‚å¼æ¸²æŸ“ç®¡çº¿è®¾è®¡**

#### **1. RenderAPIå±‚ â†’ RHIå±‚ â†’ Graphicså±‚ â†’ Rendererå±‚ â†’ Sceneå±‚**
```cpp
// å®Œæ•´çš„æ¸²æŸ“è°ƒç”¨é“¾
Application â†’ SceneViewLayer â†’ CameraRenderer â†’ RenderFeature â†’ RHI â†’ D3D12/OpenGL
```

æˆ‘è®¾è®¡å¹¶å®ç°äº†ä¸€å¥—**å®Œæ•´çš„åˆ†å±‚æ¸²æŸ“æ¶æ„**ï¼Œå±•ç°äº†å¯¹æ•´ä¸ªæ¸²æŸ“ç³»ç»Ÿçš„æ·±åº¦ç†è§£ï¼š

#### **ğŸ”¹ ç¬¬ä¸€å±‚ï¼šRenderAPIå±‚**
- **å¤šåç«¯æ”¯æŒ**ï¼šDirectX 12 + OpenGLåŒåç«¯æŠ½è±¡
- **è¿è¡Œæ—¶APIé€‰æ‹©**ï¼š`RenderAPI::GetAPI()`åŠ¨æ€åˆ‡æ¢

#### **ğŸ”¹ ç¬¬äºŒå±‚ï¼šRHIç¡¬ä»¶æŠ½è±¡å±‚**  
- **å®Œæ•´çš„ç®¡çº¿çŠ¶æ€ç®¡ç†**ï¼š`GraphicsPipeline`ã€`PipelineStateManager`
- **é«˜çº§æè¿°ç¬¦ç³»ç»Ÿ**ï¼š`IGfxViewManager`ã€å¤šçº¿ç¨‹å®‰å…¨çš„æè¿°ç¬¦åˆ†é…å™¨
- **å‘½ä»¤ç³»ç»Ÿæ¶æ„**ï¼š`CommandList`ã€`CommandQueue`æŠ½è±¡ä¸å…·ä½“å®ç°

#### **ğŸ”¹ ç¬¬ä¸‰å±‚ï¼šGraphicsåŸºç¡€è®¾æ–½å±‚**
- **PBRæè´¨ç³»ç»Ÿ**ï¼šCook-Torrance BRDFã€åŠ¨æ€æè´¨å±æ€§ã€Shaderåå°„
- **èµ„æºç®¡ç†ç³»ç»Ÿ**ï¼š`MaterialLibrary`æ™ºèƒ½ç¼“å­˜ã€`ShaderLibrary`ã€`.meta`æ–‡ä»¶åºåˆ—åŒ–
- **Meshå’ŒTextureç³»ç»Ÿ**ï¼šé›†æˆAssimpçš„å®Œæ•´èµ„æºåŠ è½½ç®¡çº¿

#### **ğŸ”¹ ç¬¬å››å±‚ï¼šRendereræ¸²æŸ“å™¨å±‚**
- **Camera-basedæ¸²æŸ“ç³»ç»Ÿ**ï¼š`CameraRenderer`æ”¯æŒå¤šç›¸æœºã€å¤šæ¸²æŸ“ç›®æ ‡
- **RenderFeatureæ¶æ„**ï¼šæ¨¡å—åŒ–æ¸²æŸ“ç‰¹æ€§ç³»ç»Ÿï¼ˆç±»ä¼¼Unity SRPï¼‰
- **Frustum Cullingç³»ç»Ÿ**ï¼šè§†é”¥ä½“å‰”é™¤ã€åŒ…å›´ç›’æ£€æµ‹ã€æ¸²æŸ“é˜Ÿåˆ—ç®¡ç†

#### **ğŸ”¹ ç¬¬äº”å±‚ï¼šSceneåœºæ™¯ç®¡ç†å±‚**
- **ECSæ¶æ„**ï¼šåŸºäºenttçš„é«˜æ€§èƒ½Entity-Component-System
- **ç»„ä»¶åŒ–æ¸²æŸ“**ï¼š`MeshRendererComponent`ã€`MaterialComponent`ã€`TransformComponent`

### **ğŸš€ å‰å‘æ¸²æŸ“ç®¡çº¿å®ç°ï¼ˆå¯¹æ ‡Unity URPï¼‰**

```cpp
void CameraRenderer::Render(const Ref<Scene>& scene) {
    // 1. è§†é”¥ä½“å‰”é™¤ - ç±»ä¼¼Unityçš„Culling
    CullVisibleObjects(context);
    
    // 2. æ¸²æŸ“é˜Ÿåˆ—åˆ†ç±» - Opaque/Transparent
    SortRenderQueues(context);
    
    // 3. æ‰§è¡Œæ¸²æŸ“ç‰¹æ€§ - ç±»ä¼¼SRPçš„RenderFeature
    for (auto& feature : m_RenderFeatures) {
        feature->Execute(context); // OpaquePassã€SkyboxPassã€TransparentPass
    }
}
```

### **ğŸ¨ å®Œæ•´çš„èµ„æºå·¥ä½œæµ**

#### **Metaæ–‡ä»¶ç³»ç»Ÿ**ï¼ˆç±»ä¼¼Unityï¼‰
```json
{
  "name": "PBR_Standard",
  "type": "PBR", 
  "shader": "Resource/shaders/PBRShader.hlsl",
  "properties": {
    "baseColor": { "type": "vec4", "value": [0.8, 0.2, 0.2, 1.0] },
    "metallic": { "type": "float", "value": 0.5 },
    "roughness": { "type": "float", "value": 0.3 }
  }
}
```

#### **æ™ºèƒ½èµ„æºç¼“å­˜ç³»ç»Ÿ**
```cpp
class MaterialLibrary {
    // åˆ†å±‚ç¼“å­˜ï¼šè·¯å¾„ç¼“å­˜(å¼±å¼•ç”¨) + å‘½åæè´¨(å¼ºå¼•ç”¨) + æ™ºèƒ½ç¼“å­˜
    std::unordered_map<std::string, std::weak_ptr<Material>> m_PathCache;
    std::unordered_map<std::string, Ref<Material>> m_NamedMaterials;
    std::unordered_map<std::string, SmartCacheEntry> m_SmartCache;
};
```

### **âš¡ D3D12é«˜çº§ç‰¹æ€§å®ç°**

#### **å¤æ‚çš„GPUå†…å­˜ç®¡ç†**
- **æè¿°ç¬¦å †åˆ†é…å™¨**ï¼šå¤šçº¿ç¨‹å®‰å…¨ã€ç©ºé—²å—ç®¡ç†ã€æ™ºèƒ½åƒåœ¾å›æ”¶
- **Pipeline Stateç¼“å­˜**ï¼šé¿å…é‡å¤PSOåˆ›å»ºï¼Œæå‡æ€§èƒ½
- **GPUåŒæ­¥æœºåˆ¶**ï¼šFence-basedåŒæ­¥ï¼Œæ”¯æŒå¤šå¸§å¹¶è¡Œ

### **ğŸ”¬ æŠ€æœ¯æ·±åº¦ä½“ç°**

#### **Shaderåå°„ç³»ç»Ÿ**
```cpp
// åŠ¨æ€æè´¨å±æ€§ç®¡ç† - ç±»ä¼¼Unity ShaderGraph
void Material::UpdateShader(const Ref<Shader>& newShader) {
    auto& newProps = ShaderReflection::ParseShaderProperties(newShader);
    // æ™ºèƒ½å±æ€§åˆå¹¶ï¼Œä¿æŒå…¼å®¹æ€§
    MergeCompatibleProperties(oldProps, newProps);
}
```

#### **è§†é”¥ä½“å‰”é™¤ç®—æ³•**
```cpp
void CullVisibleObjects(RenderContext& context) {
    Frustum cameraFrustum = m_Camera->GetFrustum();
    // ECSç³»ç»Ÿé«˜æ•ˆéå†
    auto view = context.Scene->GetRegistry().view<TransformComponent, MeshRendererComponent>();
    
    for (auto entity : view) {
        BoundingBox boundingBox = meshRenderer.Mesh->GetBoundingBox().Transform(transform.GetTransform());
        if (cameraFrustum.Intersects(boundingBox)) {
            // æ·»åŠ åˆ°å¯¹åº”æ¸²æŸ“é˜Ÿåˆ—ï¼ˆå‰åˆ°å/ååˆ°å‰æ’åºï¼‰
        }
    }
}
```

---

## ğŸ“ **ç®€å†æŠ€æœ¯æè¿°**

### **é¡¹ç›®æ ‡é¢˜**
**ShanEngine - ä¼ä¸šçº§å¤šå¹³å°æ¸²æŸ“å¼•æ“**  
*C++17 | DirectX 12 | OpenGL | PBR | ECS | ç°ä»£æ¸²æŸ“ç®¡çº¿*

### **æ ¸å¿ƒæŠ€æœ¯æˆæœ**
- **è®¾è®¡äº†å®Œæ•´çš„äº”å±‚æ¸²æŸ“æ¶æ„**ï¼ˆRenderAPIâ†’RHIâ†’Graphicsâ†’Rendererâ†’Sceneï¼‰ï¼Œå±•ç°äº†å¯¹æ•´ä¸ªæ¸²æŸ“ç³»ç»Ÿä»åº•å±‚ç¡¬ä»¶æŠ½è±¡åˆ°ä¸Šå±‚åœºæ™¯ç®¡ç†çš„ç³»ç»Ÿæ€§ç†è§£
- **å®ç°äº†Unityé£æ ¼çš„å‰å‘æ¸²æŸ“ç®¡çº¿**ï¼ŒåŒ…å«CameraRendererã€RenderFeatureæ¨¡å—åŒ–ç³»ç»Ÿã€Frustum Cullingå’Œæ¸²æŸ“é˜Ÿåˆ—ç®¡ç†ï¼Œæ”¯æŒå¤šç›¸æœºå¤šæ¸²æŸ“ç›®æ ‡
- **æ„å»ºäº†ä¼ä¸šçº§çš„èµ„æºç®¡ç†ç³»ç»Ÿ**ï¼ŒåŒ…å«MaterialLibraryæ™ºèƒ½ç¼“å­˜ã€ShaderLibraryã€.metaæ–‡ä»¶åºåˆ—åŒ–å’ŒAssimpé›†æˆï¼Œå®ç°äº†å®Œæ•´çš„èµ„æºå·¥ä½œæµ
- **å¼€å‘äº†ç°ä»£åŒ–PBRæ¸²æŸ“ç³»ç»Ÿ**ï¼Œå®ç°Cook-Torrance BRDFã€åŠ¨æ€æè´¨ç³»ç»Ÿã€Shaderåå°„å’ŒåŸºäºç‰©ç†çš„å…‰ç…§æ¨¡å‹

### **æŠ€æœ¯è§„æ¨¡ä¸æ·±åº¦**
- **ä»£ç è§„æ¨¡**ï¼š60K+ LOCï¼Œå®Œæ•´çš„å¼•æ“æ¶æ„è®¾è®¡
- **æŠ€æœ¯æ ˆ**ï¼šDirectX 12é«˜çº§ç‰¹æ€§ã€ç°ä»£C++17ã€ECSæ¶æ„ã€å¤šçº¿ç¨‹æ¸²æŸ“
- **ç³»ç»Ÿå¤æ‚åº¦**ï¼šå¤šå±‚æŠ½è±¡è®¾è®¡ã€GPUå†…å­˜ç®¡ç†ã€æè¿°ç¬¦å †ä¼˜åŒ–ã€ç®¡çº¿çŠ¶æ€ç¼“å­˜

è¿™æ ·çš„æè¿°**æ¸…æ™°å±•ç°äº†ä½ å¯¹æ¸²æŸ“ç³»ç»Ÿçš„å®Œæ•´ç†è§£**ï¼Œä»åº•å±‚RHIåˆ°ä¸Šå±‚æ¸²æŸ“ç‰¹æ€§ï¼Œé¢è¯•å®˜èƒ½å¤Ÿæ˜ç¡®æ„Ÿå—åˆ°ä½ å…·å¤‡**ç³»ç»Ÿæ€§çš„æ¸²æŸ“æ¶æ„è®¾è®¡èƒ½åŠ›**ï¼Œè€Œä¸ä»…ä»…æ˜¯å•ç‚¹æŠ€æœ¯å®ç°ã€‚