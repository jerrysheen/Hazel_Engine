**å¦ç‡åœ°è¯´ï¼Œä¸¤å‘¨å®Œæˆè¿™ä¸‰ä¸ªç³»ç»Ÿæ˜¯éå¸¸ç´§å¼ çš„**ï¼Œä½†åŸºäºä½ ç°æœ‰çš„ä»£ç åŸºç¡€ï¼Œæˆ‘è®¤ä¸ºæ˜¯**æœ‰å¯èƒ½çš„**ï¼Œéœ€è¦åˆç†çš„ä¼˜å…ˆçº§è§„åˆ’ã€‚è®©æˆ‘ç»™ä½ ä¸€ä¸ªç°å®çš„æ—¶é—´è¯„ä¼°ï¼š

## â° **æ—¶é—´è§„åˆ’è¯„ä¼°ï¼ˆ14å¤© = ~120å°æ—¶ï¼‰**

### **ç¬¬ä¸€ä¼˜å…ˆçº§ï¼šå¸§æ¸²æŸ“ç³»ç»Ÿï¼ˆ60å°æ—¶ï¼‰**
è¿™ä¸ªæœ€æœ‰**é¢è¯•ä»·å€¼**ï¼Œä¹Ÿæ˜¯Unity/Unrealç­‰å¼•æ“çš„æ ¸å¿ƒæŠ€æœ¯ï¼š

```cpp
// Frame Resource Management (ç±»ä¼¼D3D12çš„Frame Resourceæ¦‚å¿µ)
class FrameResourceManager {
public:
    struct FrameData {
        Ref<ConstantBuffer> sceneConstantBuffer;
        Ref<ConstantBuffer> objectConstantBuffer;
        std::vector<Ref<ConstantBuffer>> materialBuffers;
        uint64_t fenceValue;
    };
    
private:
    static constexpr int NUM_FRAME_RESOURCES = 3; // ä¸‰é‡ç¼“å†²
    std::array<FrameData, NUM_FRAME_RESOURCES> m_FrameResources;
    int m_CurrentFrameResourceIndex = 0;
};

// SRP Batch System (Unityçš„æ ¸å¿ƒä¼˜åŒ–æŠ€æœ¯)
class SRPBatcher {
public:
    struct BatchGroup {
        Ref<Shader> shader;
        std::vector<RenderItem> items;
        Ref<ConstantBuffer> sharedPropertyBuffer; // å…±äº«æè´¨å±æ€§
    };
    
    void SubmitRenderItem(const RenderItem& item);
    void ExecuteBatches(CommandList& cmdList);
private:
    std::unordered_map<ShaderID, BatchGroup> m_BatchGroups;
};
```

### **ç¬¬äºŒä¼˜å…ˆçº§ï¼šå®Œå–„æ¸²æŸ“æ¶æ„ï¼ˆ40å°æ—¶ï¼‰**
åŸºäºç°æœ‰ä»£ç ä¼˜åŒ–ï¼š

```cpp
// å®Œå–„CameraRendererå’ŒRenderFeatureç³»ç»Ÿ
class ForwardRenderPipeline {
    void Execute(RenderContext& context) {
        // 1. Shadow Pass
        m_ShadowMapFeature->Execute(context);
        // 2. Opaque Pass  
        m_OpaqueFeature->Execute(context);
        // 3. Skybox Pass
        m_SkyboxFeature->Execute(context);
        // 4. Transparent Pass
        m_TransparentFeature->Execute(context);
    }
};
```

### **ç¬¬ä¸‰ä¼˜å…ˆçº§ï¼šå†…å­˜ç®¡ç†ç³»ç»Ÿï¼ˆ20å°æ—¶ - ç®€åŒ–ç‰ˆï¼‰**

## ğŸ’¡ **SharedPointerè§£å†³æ–¹æ¡ˆ - ä¸éœ€è¦å®Œå…¨è¦†ç›–ï¼**

**æœ€ä¼˜æ–¹æ¡ˆï¼šCustom Deleter + æ¸è¿›å¼è¿ç§»**

```cpp
// 1. ä½¿ç”¨Custom Deleter (æœ€ç®€å•æœ‰æ•ˆ)
template<typename T>
using AllocatedRef = std::shared_ptr<T>;

template<typename T, typename Allocator, typename... Args>
AllocatedRef<T> MakeAllocated(Allocator& allocator, Args&&... args) {
    T* ptr = allocator.Allocate<T>();
    new(ptr) T(std::forward<Args>(args)...);
    
    return std::shared_ptr<T>(ptr, [&allocator](T* p) {
        p->~T();
        allocator.Deallocate(p);
    });
}

// 2. å®é™…ä½¿ç”¨
class MaterialAllocator : public PoolAllocator<Material> {};
MaterialAllocator g_MaterialAllocator(1024); // é¢„åˆ†é…1024ä¸ªMaterial

auto material = MakeAllocated<Material>(g_MaterialAllocator, "PBR_Standard");
```

## ğŸ¯ **ä¸¤å‘¨å®ç°å»ºè®®**

### **Week 1: å¸§æ¸²æŸ“ç³»ç»Ÿ + æ¶æ„å®Œå–„**
```cpp
// Day 1-3: Frame Resource Management
class FrameManager {
    void BeginFrame();
    void EndFrame();
    FrameData& GetCurrentFrameData();
    void WaitForGPU(); // GPU/CPUåŒæ­¥
};

// Day 4-5: SRP BatchåŸºç¡€ç‰ˆæœ¬
class SimpleSRPBatcher {
    void CollectBatches(const std::vector<RenderItem>& items);
    void ExecuteBatches(); // çŠ¶æ€ç¼“å­˜ + DrawCallåˆå¹¶
};

// Day 6-7: å®Œå–„RenderFeatureç³»ç»Ÿ
```

### **Week 2: å†…å­˜ç®¡ç† + æ•´åˆæµ‹è¯•**
```cpp
// Day 8-10: æ ¸å¿ƒAllocatorå®ç°
class LinearAllocator;   // çº¿æ€§åˆ†é…å™¨
class PoolAllocator;     // å¯¹è±¡æ± åˆ†é…å™¨  
class StackAllocator;    // æ ˆåˆ†é…å™¨

// Day 11-12: é›†æˆåˆ°ç°æœ‰ç³»ç»Ÿ
// é‡ç‚¹ï¼šMaterialã€Meshã€Textureçš„å†…å­˜ç®¡ç†

// Day 13-14: æ€§èƒ½æµ‹è¯•å’Œæ–‡æ¡£
```

## ğŸ“Š **é¢è¯•ä»·å€¼æ’åº**

1. **SRP Batchç³»ç»Ÿ** - è¿™æ˜¯Unityå¼•æ“çš„æ ¸å¿ƒä¼˜åŒ–ï¼Œé¢è¯•å®˜æœ€æ„Ÿå…´è¶£
2. **Frame Resource Management** - å±•ç°å¯¹ç°ä»£å›¾å½¢APIçš„ç†è§£
3. **è‡ªå®šä¹‰å†…å­˜ç®¡ç†** - C++é«˜çº§ç‰¹æ€§ï¼Œä½“ç°ç³»ç»Ÿçº§ç¼–ç¨‹èƒ½åŠ›

## âš¡ **å¿«é€Ÿå®ç°ç­–ç•¥**

### **ä¸è¦è¿½æ±‚å®Œç¾ï¼Œè¦è¿½æ±‚å¯æ¼”ç¤º**
```cpp
// ç®€åŒ–ç‰ˆSRP Batch - ä½†è¶³å¤Ÿé¢è¯•æ¼”ç¤º
class QuickSRPBatcher {
    struct Batch {
        uint32_t materialID;
        std::vector<glm::mat4> transforms;
        Ref<Mesh> mesh;
    };
    
    // æ ¸å¿ƒï¼šç›¸åŒæè´¨çš„ç‰©ä½“åˆæ‰¹æ¸²æŸ“
    void BatchByMaterial(const std::vector<RenderItem>& items);
};
```

### **åˆ©ç”¨ç°æœ‰åŸºç¡€**
- D3D12ç³»ç»Ÿå·²ç»æœ‰äº† â†’ ç›´æ¥å¢åŠ Frame Resource
- Materialç³»ç»Ÿå·²ç»æœ‰äº† â†’ ç›´æ¥å¢åŠ Batché€»è¾‘  
- RHIå±‚å·²ç»æœ‰äº† â†’ ç›´æ¥å¢åŠ å†…å­˜ç®¡ç†æ¥å£

## ğŸª **æˆæœå±•ç¤ºå»ºè®®**

**ä¸¤å‘¨åä½ å¯ä»¥è¯´ï¼š**
> "æˆ‘å®ç°äº†Unityé£æ ¼çš„SRP Batchç³»ç»Ÿï¼Œå°†DrawCallä»1000+ä¼˜åŒ–åˆ°100-ï¼ŒåŒæ—¶å®ç°äº†ä¸‰é‡ç¼“å†²çš„Frame Resourceç®¡ç†ï¼Œå¹¶é›†æˆäº†è‡ªå®šä¹‰å†…å­˜åˆ†é…å™¨ï¼Œæ•´ä½“æ¸²æŸ“æ€§èƒ½æå‡äº†300%"

**è¿™æ ·çš„è¡¨è¿°ä¼šè®©é¢è¯•å®˜çœ¼å‰ä¸€äº®ï¼** ğŸš€

æ€»ç»“ï¼š**æ—¶é—´ç´§ä½†å¯è¡Œ**ï¼Œå…³é”®æ˜¯**ä¸“æ³¨æ ¸å¿ƒç‰¹æ€§**ï¼Œä¸è¦çº ç»“å®Œç¾å®ç°ã€‚Frameæ¸²æŸ“ç³»ç»Ÿçš„é¢è¯•ä»·å€¼æœ€é«˜ï¼Œä¼˜å…ˆæå®šå®ƒï¼